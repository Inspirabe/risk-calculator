<ion-header>
  <ion-toolbar>
      <div class="flex items-center justify-center">
        <img src="assets/logo.png" alt="Risk Calculator" class="title-icon" />
        <span>Risk Calculator</span>
      </div>
  </ion-toolbar>
</ion-header>

<!-- <ion-content [fullscreen]="true">
  <app-explore-container name="Tab 1 page"></app-explore-container>
</ion-content> -->

<!-- <ion-content [fullscreen]="true" class="p-0"> -->
    
<ion-content [fullscreen]="true">
    <ion-list inset="true">
        <ion-item lines="full">
            <ion-label class="font-semibold">Trade</ion-label>
        </ion-item>

        <ion-item lines="none">
            <ion-label position="stacked" class="text-xs font-medium">Entry Price</ion-label>
            <ion-input 
                type="text" 
                placeholder="0"
                inputmode="decimal" 
                enterkeyhint="done"
                (ionBlur)="onEntryBlur()"
                (ionFocus)="selectAll($event)"
                [(ngModel)]="entry_price_raw" 
                [clearInput]="true"
                class="bg-gray-100 dark:bg-gray-800 rounded-md text-sm" 
                style="--padding-start: 0.75rem;"
                >
                <div slot="start" class="flex items-center justify-center w-6 text-gray-500 dark:text-gray-400">$</div>
            </ion-input>
        </ion-item>

        <ion-item lines="none">
            <ion-label position="stacked" class="text-xs font-medium">Take Profit</ion-label>
            <ion-input 
                type="text" 
                placeholder="0"
                inputmode="decimal" 
                enterkeyhint="done"
                (ionBlur)="onTakeProfitBlur()"
                (ionFocus)="selectAll($event)"
                [(ngModel)]="take_profit_raw" 
                [clearInput]="true"
                class="bg-gray-100 dark:bg-gray-800 rounded-md text-sm" 
                style="--padding-start: 0.75rem;"
                >
                <div slot="start" class="flex items-center justify-center w-6 text-gray-500 dark:text-gray-400">$</div>
            </ion-input>
        </ion-item>

        <ion-item lines="none">
            <ion-label position="stacked" class="text-xs font-medium">Stop Loss</ion-label>
            <ion-input 
                type="text" 
                placeholder="0"
                inputmode="decimal" 
                enterkeyhint="done"
                (ionBlur)="onStopLossBlur()"
                (ionFocus)="selectAll($event)"
                [(ngModel)]="stop_loss_price_raw" 
                [clearInput]="true"
                class="bg-gray-100 dark:bg-gray-800 rounded-md text-sm" 
                style="--padding-start: 0.75rem;"
                >
                <div slot="start" class="flex items-center justify-center w-6 text-gray-500 dark:text-gray-400">$</div>
            </ion-input>
        </ion-item>

        <div class="flex items-center gap-3 my-2 px-2">
            <ion-button expand="block" class="flex-1" (click)="calc()">Calculate</ion-button>
            <ion-button fill="outline" class="flex-1" (click)="reset()">Reset</ion-button>
        </div>
    </ion-list>


    <ion-card 
        class="p-3 my-2 rounded-2xl"
        [ngClass]="{
            'bg-white dark:bg-gray-800': risk_reward === 0,
            'bg-green-100': risk_reward > 2,
            'bg-yellow-100': risk_reward > 1 && risk_reward <= 2,
            'bg-red-100': risk_reward > 0 && risk_reward <= 1
        }">
        <div class="grid grid-cols-1 text-center">
            <p class="text-muted">Risk / Reward</p>
            <p 
            class="text-3xl font-bold text-center"
            [ngClass]="{
                'text-green-600': risk_reward > 2,
                'text-yellow-600': risk_reward > 1 && risk_reward <= 2,
                'text-red-600': risk_reward > 0 && risk_reward <= 1
            }">{{ risk_reward | number:'1.2-2' }}</p>
            <p class="text-muted">Position size</p>
            <p 
            class="text-3xl font-bold text-center"
            [ngClass]="{
                'text-green-600': risk_reward > 2,
                'text-yellow-600': risk_reward > 1 && risk_reward <= 2,
                'text-red-600': risk_reward > 0 && risk_reward <= 1
            }">{{ position_size | number:'1.2-2' }} $</p>
        </div>

        <div class="grid grid-cols-2 text-center">
            <p class="text-muted" (click)="applyRecommendedLeverage()">Recom. Leverage</p>
            <p class="text-muted">Margin cost</p>
            <p class="font-bold" (click)="applyRecommendedLeverage()">{{ recommended_leverage | number:'1.0-0' }}</p>
            <p class="font-bold">{{ margin_cost | number:'1.2-2' }} $</p>
        </div>
    </ion-card>

    <ion-list inset="true">
        <!-- <ion-item lines="full">
            <ion-label class="font-semibold">Titel</ion-label>
        </ion-item> -->

        <!-- Compact item met klikbare waarde rechts -->
        <ion-item lines="none" class="py-0">
            <ion-label class="font-[0.875rem] font-medium">Leverage</ion-label>
            <button type="button"
                    slot="end"
                    (click)="openLeverage()"
                    class="px-3 py-1 rounded-lg bg-gray-100 dark:bg-gray-800 text-sm font-semibold">
                {{ leverage }}<span class="opacity-70">x</span>
            </button>
        </ion-item>

        
        <ion-item lines="full">
            <ion-label class="font-[0.875rem] font-medium">Futures</ion-label>
            <button
                type="button"
                slot="end"
                (click)="openSymbolPicker()"
                class="px-3 py-1 rounded-lg bg-gray-100 dark:bg-gray-800 text-sm font-semibold">
                {{ settings.selected_symbol?.display || 'Select' }}
            </button>
        </ion-item>
    </ion-list>

    <div class="flex items-center gap-3 mt-0 mb-3 px-5">
        <ion-button expand="block"
                class="flex-1"
                *ngIf="showUserTrade"
                [disabled]="!readyToLog() || submitting || tradeLogged"
                (click)="userTrade()">
            <ion-spinner *ngIf="submitting" name="lines-small"></ion-spinner>
            <ng-container *ngIf="!submitting">
                {{ tradeLogged ? 'Trade Logged' : 'Log Trade' }}
            </ng-container>
        </ion-button>

        <ion-button expand="block" 
            class="flex-1" 
            color="secondary"
            *ngIf="!showUserTrade && settings.selected_platform != ''"
            (click)="placeTrade()">
            <ion-spinner *ngIf="submittingTrade" name="lines-small"></ion-spinner>
            <ng-container >Submit Trade on {{this.settings.platform_label}}</ng-container>
        </ion-button>
    </div>
    
</ion-content>
